@using System.Text.Json
@model List<ServicioRealizadoViewModel>

@{
    ViewData["Title"] = "Reporte de Servicios Realizados";

    var etiquetas = Model.Select(s => s.NombreServicio).ToList();
    var cantidades = Model.Select(s => s.Cantidad).ToList();
}

<div class="container mt-4">
    <h2>Reporte de Servicios Realizados</h2>

    <form asp-action="ReporteServiciosRealizados" method="get" class="form-inline mb-3">
        <label for="startDate" class="mr-2">Fecha de Inicio:</label>
        <input type="date" id="startDate" name="startDate" class="form-control mr-2" required />

        <label for="endDate" class="mr-2">Fecha de Fin:</label>
        <input type="date" id="endDate" name="endDate" class="form-control mr-2" required />

        <button type="submit" class="btn btn-primary">Filtrar</button>
    </form>

    @if (Model != null && Model.Any())
    {
        <h3 class="mt-4">Resultados</h3>
        <table class="table table-bordered mt-2">
            <thead class="thead-dark">
                <tr>
                    <th>Servicio</th>
                    <th>Cantidad</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var servicio in Model)
                {
                    <tr>
                        <td>@servicio.NombreServicio</td>
                        <td>@servicio.Cantidad</td>
                    </tr>
                }
            </tbody>
        </table>
    }
    else
    {
        <p class="text-muted">No se encontraron servicios realizados en el rango de fechas seleccionado.</p>
    }

    <div class="mt-4" style="max-width: 500px; max-height: 500px;">
    <canvas id="myPieChart"></canvas>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
    // Obtenemos los datos desde Razor
    const etiquetas = @Html.Raw(JsonSerializer.Serialize(etiquetas));
    const cantidades = @Html.Raw(JsonSerializer.Serialize(cantidades));

    // Configuración del gráfico de torta
    const ctx = document.getElementById('myPieChart').getContext('2d');
    new Chart(ctx, {
        type: 'pie',
        data: {
            labels: etiquetas,
            datasets: [{
                label: 'Servicios Realizados',
                data: cantidades,
                backgroundColor: [
                    'rgba(255, 99, 132, 0.2)',
                    'rgba(54, 162, 235, 0.2)',
                    'rgba(255, 206, 86, 0.2)',
                    'rgba(75, 192, 192, 0.2)',
                    'rgba(153, 102, 255, 0.2)',
                    'rgba(255, 159, 64, 0.2)'
                ],
                borderColor: [
                    'rgba(255, 99, 132, 1)',
                    'rgba(54, 162, 235, 1)',
                    'rgba(255, 206, 86, 1)',
                    'rgba(75, 192, 192, 1)',
                    'rgba(153, 102, 255, 1)',
                    'rgba(255, 159, 64, 1)'
                ],
                borderWidth: 1
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: true
        }
    });
</script>
